<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>tmdb02 | Datenwerk</title>
<meta name="keywords" content="tidymodels, prediction, tmdb">
<meta name="description" content="Exercise Wir bearbeiten hier die Fallstudie TMDB Box Office Prediction - Can you predict a movie’s worldwide box office revenue?, ein Kaggle-Prognosewettbewerb.
Ziel ist es, genaue Vorhersagen zu machen, in diesem Fall für Filme.
Die Daten können Sie von der Kaggle-Projektseite beziehen oder so:
d_train_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv&quot; d_test_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv&quot; Aufgabe Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Kaggle-Score
Hinweise:
 Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden.">
<meta name="author" content="Sebastian Sauer">
<link rel="canonical" href="https://datenwerk.netlify.app/post/tmdb02/tmdb02/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.11456fe0da96a3038931cd29485a8226ce668dbd3dae9895bd769fd7b6b7959f.css" integrity="sha256-EUVv4NqWowOJMc0pSFqCJs5mjb09rpiVvXaf17a3lZ8=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://datenwerk.netlify.app/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://datenwerk.netlify.app/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://datenwerk.netlify.app/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://datenwerk.netlify.app/apple-touch-icon.png">
<link rel="mask-icon" href="https://datenwerk.netlify.app/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<script async type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<meta property="og:title" content="tmdb02" />
<meta property="og:description" content="Exercise Wir bearbeiten hier die Fallstudie TMDB Box Office Prediction - Can you predict a movie’s worldwide box office revenue?, ein Kaggle-Prognosewettbewerb.
Ziel ist es, genaue Vorhersagen zu machen, in diesem Fall für Filme.
Die Daten können Sie von der Kaggle-Projektseite beziehen oder so:
d_train_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv&quot; d_test_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv&quot; Aufgabe Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Kaggle-Score
Hinweise:
 Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://datenwerk.netlify.app/post/tmdb02/tmdb02/" />
<meta property="og:image" content="https://datenwerk.netlify.app/img/cups1.jpg" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-07-11T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-07-11T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://datenwerk.netlify.app/img/cups1.jpg" />
<meta name="twitter:title" content="tmdb02"/>
<meta name="twitter:description" content="Exercise Wir bearbeiten hier die Fallstudie TMDB Box Office Prediction - Can you predict a movie’s worldwide box office revenue?, ein Kaggle-Prognosewettbewerb.
Ziel ist es, genaue Vorhersagen zu machen, in diesem Fall für Filme.
Die Daten können Sie von der Kaggle-Projektseite beziehen oder so:
d_train_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv&quot; d_test_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv&quot; Aufgabe Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Kaggle-Score
Hinweise:
 Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://datenwerk.netlify.app/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "tmdb02",
      "item": "https://datenwerk.netlify.app/post/tmdb02/tmdb02/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "tmdb02",
  "name": "tmdb02",
  "description": "Exercise Wir bearbeiten hier die Fallstudie TMDB Box Office Prediction - Can you predict a movie’s worldwide box office revenue?, ein Kaggle-Prognosewettbewerb.\nZiel ist es, genaue Vorhersagen zu machen, in diesem Fall für Filme.\nDie Daten können Sie von der Kaggle-Projektseite beziehen oder so:\nd_train_path \u0026lt;- \u0026quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv\u0026quot; d_test_path \u0026lt;- \u0026quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv\u0026quot; Aufgabe Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Kaggle-Score\nHinweise:\n Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden.",
  "keywords": [
    "tidymodels", "prediction", "tmdb"
  ],
  "articleBody": " Exercise Wir bearbeiten hier die Fallstudie TMDB Box Office Prediction - Can you predict a movie’s worldwide box office revenue?, ein Kaggle-Prognosewettbewerb.\nZiel ist es, genaue Vorhersagen zu machen, in diesem Fall für Filme.\nDie Daten können Sie von der Kaggle-Projektseite beziehen oder so:\nd_train_path  Aufgabe Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Kaggle-Score\nHinweise:\n Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden. Berechnen Sie einen Entscheidungsbaum und einen Random-Forest. Tunen Sie nach Bedarf; verwenden Sie aber Default-Werte. Verwenden Sie Tidymodels.           \n  Solution Vorbereitung library(tidyverse) library(tidymodels) library(tictoc) d_train  ## Rows: 3,000 ## Columns: 23 ## $ id  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1… ## $ belongs_to_collection  \"[{'id': 313576, 'name': 'Hot Tub Time Machine C… ## $ budget  1.40e+07, 4.00e+07, 3.30e+06, 1.20e+06, 0.00e+00… ## $ genres  \"[{'id': 35, 'name': 'Comedy'}]\", \"[{'id': 35, '… ## $ homepage  NA, NA, \"http://sonyclassics.com/whiplash/\", \"ht… ## $ imdb_id  \"tt2637294\", \"tt0368933\", \"tt2582802\", \"tt182148… ## $ original_language  \"en\", \"en\", \"en\", \"hi\", \"ko\", \"en\", \"en\", \"en\", … ## $ original_title  \"Hot Tub Time Machine 2\", \"The Princess Diaries … ## $ overview  \"When Lou, who has become the \\\"father of the In… ## $ popularity  6.575393, 8.248895, 64.299990, 3.174936, 1.14807… ## $ poster_path  \"/tQtWuwvMf0hCc2QR2tkolwl7c3c.jpg\", \"/w9Z7A0GHEh… ## $ production_companies  \"[{'name': 'Paramount Pictures', 'id': 4}, {'nam… ## $ production_countries  \"[{'iso_3166_1': 'US', 'name': 'United States of… ## $ release_date  \"2/20/15\", \"8/6/04\", \"10/10/14\", \"3/9/12\", \"2/5/… ## $ runtime  93, 113, 105, 122, 118, 83, 92, 84, 100, 91, 119… ## $ spoken_languages  \"[{'iso_639_1': 'en', 'name': 'English'}]\", \"[{'… ## $ status  \"Released\", \"Released\", \"Released\", \"Released\", … ## $ tagline  \"The Laws of Space and Time are About to be Viol… ## $ title  \"Hot Tub Time Machine 2\", \"The Princess Diaries … ## $ Keywords  \"[{'id': 4379, 'name': 'time travel'}, {'id': 96… ## $ cast  \"[{'cast_id': 4, 'character': 'Lou', 'credit_id'… ## $ crew  \"[{'credit_id': '59ac067c92514107af02c8c8', 'dep… ## $ revenue  12314651, 95149435, 13092000, 16000000, 3923970,… glimpse(d_test) ## Rows: 4,398 ## Columns: 22 ## $ id  3001, 3002, 3003, 3004, 3005, 3006, 3007, 3008, … ## $ belongs_to_collection  \"[{'id': 34055, 'name': 'Pokémon Collection', 'p… ## $ budget  0.00e+00, 8.80e+04, 0.00e+00, 6.80e+06, 2.00e+06… ## $ genres  \"[{'id': 12, 'name': 'Adventure'}, {'id': 16, 'n… ## $ homepage  \"http://www.pokemon.com/us/movies/movie-pokemon-… ## $ imdb_id  \"tt1226251\", \"tt0051380\", \"tt0118556\", \"tt125595… ## $ original_language  \"ja\", \"en\", \"en\", \"fr\", \"en\", \"en\", \"de\", \"en\", … ## $ original_title  \"ディアルガVSパルキアVSダークライ\", \"Attack of t… ## $ overview  \"Ash and friends (this time accompanied by newco… ## $ popularity  3.851534, 3.559789, 8.085194, 8.596012, 3.217680… ## $ poster_path  \"/tnftmLMemPLduW6MRyZE0ZUD19z.jpg\", \"/9MgBNBqlH1… ## $ production_companies  NA, \"[{'name': 'Woolner Brothers Pictures Inc.',… ## $ production_countries  \"[{'iso_3166_1': 'JP', 'name': 'Japan'}, {'iso_3… ## $ release_date  \"7/14/07\", \"5/19/58\", \"5/23/97\", \"9/4/10\", \"2/11… ## $ runtime  90, 65, 100, 130, 92, 121, 119, 77, 120, 92, 88,… ## $ spoken_languages  \"[{'iso_639_1': 'en', 'name': 'English'}, {'iso_… ## $ status  \"Released\", \"Released\", \"Released\", \"Released\", … ## $ tagline  \"Somewhere Between Time \u0026 Space... A Legend Is B… ## $ title  \"Pokémon: The Rise of Darkrai\", \"Attack of the 5… ## $ Keywords  \"[{'id': 11451, 'name': 'pok√©mon'}, {'id': 1155… ## $ cast  \"[{'cast_id': 3, 'character': 'Tonio', 'credit_i… ## $ crew  \"[{'credit_id': '52fe44e7c3a368484e03d683', 'dep…  Rezept Rezept definieren rec1 % update_role(all_predictors(), new_role = \"id\") %% update_role(popularity, runtime, revenue, budget) %% update_role(revenue, new_role = \"outcome\") %% step_mutate(budget = ifelse(budget % step_log(budget) %% step_impute_knn(all_predictors()) rec1 ## Recipe ## ## Inputs: ## ## role #variables ## id 19 ## outcome 1 ## predictor 3 ## ## Operations: ## ## Variable mutation for ifelse(budget   Check das Rezept rec1_prepped  ## oper 1 step mutate [training] ## oper 2 step log [training] ## oper 3 step impute knn [training] ## The retained training set is ~ 28.71 Mb in memory. rec1_prepped ## Recipe ## ## Inputs: ## ## role #variables ## id 19 ## outcome 1 ## predictor 3 ## ## Training data contained 3000 data points and 2793 incomplete rows. ## ## Operations: ## ## Variable mutation for ~ifelse(budget  d_train_baked % bake(new_data = NULL) head(d_train_baked) ## # A tibble: 6 × 23 ## id belongs_…¹ budget genres homep…² imdb_id origi…³ origi…⁴ overv…⁵ popul…⁶ ##           ## 1 1 [{'id': 3… 16.5 [{'id…  tt2637… en Hot Tu… \"When … 6.58 ## 2 2 [{'id': 1… 17.5 [{'id…  tt0368… en The Pr… \"Mia T… 8.25 ## 3 3  15.0 [{'id… http:/… tt2582… en Whipla… \"Under… 64.3 ## 4 4  14.0 [{'id… http:/… tt1821… hi Kahaani \"Vidya… 3.17 ## 5 5  2.30 [{'id…  tt1380… ko 마린보… \"Marin… 1.15 ## 6 6  15.9 [{'id…  tt0093… en Pinocc… \"Pinoc… 0.743 ## # … with 13 more variables: poster_path , production_companies , ## # production_countries , release_date , runtime , ## # spoken_languages , status , tagline , title , ## # Keywords , cast , crew , revenue , and abbreviated ## # variable names ¹​belongs_to_collection, ²​homepage, ³​original_language, ## # ⁴​original_title, ⁵​overview, ⁶​popularity ## # ℹ Use `colnames()` to see all variable names Die AV-Spalte sollte leer sein:\nbake(rec1_prepped, new_data = head(d_test), all_outcomes()) ## # A tibble: 6 × 0 d_train_baked %% map_df(~ sum(is.na(.))) ## # A tibble: 1 × 23 ## id belongs_…¹ budget genres homep…² imdb_id origi…³ origi…⁴ overv…⁵ popul…⁶ ##           ## 1 0 2396 0 7 2054 0 0 0 8 0 ## # … with 13 more variables: poster_path , production_companies , ## # production_countries , release_date , runtime , ## # spoken_languages , status , tagline , title , ## # Keywords , cast , crew , revenue , and abbreviated ## # variable names ¹​belongs_to_collection, ²​homepage, ³​original_language, ## # ⁴​original_title, ⁵​overview, ⁶​popularity ## # ℹ Use `colnames()` to see all variable names Keine fehlenden Werte mehr in den Prädiktoren.\nNach fehlenden Werten könnte man z.B. auch so suchen:\ndatawizard::describe_distribution(d_train_baked) ## Variable | Mean | SD | IQR | Range | Skewness | Kurtosis | n | n_Missing ## --------------------------------------------------------------------------------------------------------- ## id | 1500.50 | 866.17 | 1500.50 | [1.00, 3000.00] | 0.00 | -1.20 | 3000 | 0 ## budget | 12.51 | 6.44 | 14.88 | [2.30, 19.76] | -0.87 | -1.09 | 3000 | 0 ## popularity | 8.46 | 12.10 | 6.88 | [1.00e-06, 294.34] | 14.38 | 280.10 | 3000 | 0 ## runtime | 107.85 | 22.08 | 24.00 | [0.00, 338.00] | 1.02 | 8.20 | 3000 | 0 ## revenue | 6.67e+07 | 1.38e+08 | 6.66e+07 | [1.00, 1.52e+09] | 4.54 | 27.78 | 3000 | 0 So bekommt man gleich noch ein paar Infos über die Verteilung der Variablen. Praktische Sache.\nDas Test-Sample backen wir auch mal:\nd_test_baked % head() ## # A tibble: 6 × 22 ## id belongs_…¹ budget genres homep…² imdb_id origi…³ origi…⁴ overv…⁵ popul…⁶ ##           ## 1 3001 [{'id': 3… 2.30 [{'id…   ja   3.85 ## 2 3002  11.4 [{'id…   en   3.56 ## 3 3003  2.30 [{'id…   en   8.09 ## 4 3004  15.7    fr   8.60 ## 5 3005  14.5 [{'id…   en   3.22 ## 6 3006  2.30 [{'id…   en   8.68 ## # … with 12 more variables: poster_path , production_companies , ## # production_countries , release_date , runtime , ## # spoken_languages , status , tagline , title , ## # Keywords , cast , crew , and abbreviated variable names ## # ¹​belongs_to_collection, ²​homepage, ³​original_language, ⁴​original_title, ## # ⁵​overview, ⁶​popularity ## # ℹ Use `colnames()` to see all variable names   Kreuzvalidierung cv_scheme   Modelle Baum mod_tree   Random Forest doParallel::registerDoParallel() mod_rf % set_engine(\"ranger\", num.threads = 4)   Workflows wf_tree % add_model(mod_tree) %% add_recipe(rec1) wf_rf % add_model(mod_rf) %% add_recipe(rec1)  Fitten und tunen Um Rechenzeit zu sparen, kann man den Parameter grid bei tune_grid() auf einen kleinen Wert setzen. Der Default ist 10. Um gute Vorhersagen zu erzielen, sollte man den Wert tendenziell noch über 10 erhöhen.\nTree tic() tree_fit % tune_grid( resamples = cv_scheme, grid = 2 ) toc() ## 3.374 sec elapsed Hilfe zu tune_grid() bekommt man hier.\ntree_fit ## # Tuning results ## # 5-fold cross-validation ## # A tibble: 5 × 4 ## splits id .metrics .notes ##     ## 1 Fold1 ## 2 Fold2 ## 3 Fold3 ## 4 Fold4 ## 5 Fold5  Steht was in den .notes?\ntree_fit[[\".notes\"]][[2]] ## # A tibble: 0 × 3 ## # … with 3 variables: location , type , note  ## # ℹ Use `colnames()` to see all variable names Nein.\ncollect_metrics(tree_fit) ## # A tibble: 4 × 8 ## cost_complexity tree_depth .metric .estimator mean n std_err .config ##         ## 1 0.00000000100 5 rmse standard 8.59e+7 5 4.68e+6 Prepro… ## 2 0.00000000100 5 rsq standard 6.12e-1 5 2.76e-2 Prepro… ## 3 0.00000781 9 rmse standard 8.76e+7 5 3.86e+6 Prepro… ## 4 0.00000781 9 rsq standard 5.99e-1 5 2.49e-2 Prepro… show_best(tree_fit) ## Warning: No value of `metric` was given; metric 'rmse' will be used. ## # A tibble: 2 × 8 ## cost_complexity tree_depth .metric .estimator mean n std_err .config ##         ## 1 0.00000000100 5 rmse standard 85864841. 5 4676421. Prepro… ## 2 0.00000781 9 rmse standard 87647236. 5 3862933. Prepro…   Finalisieren best_tree_wf % finalize_workflow(select_best(tree_fit)) ## Warning: No value of `metric` was given; metric 'rmse' will be used. best_tree_wf ## ══ Workflow ════════════════════════════════════════════════════════════════════ ## Preprocessor: Recipe ## Model: decision_tree() ## ## ── Preprocessor ──────────────────────────────────────────────────────────────── ## 3 Recipe Steps ## ## • step_mutate() ## • step_log() ## • step_impute_knn() ## ## ── Model ─────────────────────────────────────────────────────────────────────── ## Decision Tree Model Specification (regression) ## ## Main Arguments: ## cost_complexity = 1.00205814434566e-09 ## tree_depth = 5 ## ## Computational engine: rpart tree_last_fit  ## ══ Workflow [trained] ══════════════════════════════════════════════════════════ ## Preprocessor: Recipe ## Model: decision_tree() ## ## ── Preprocessor ──────────────────────────────────────────────────────────────── ## 3 Recipe Steps ## ## • step_mutate() ## • step_log() ## • step_impute_knn() ## ## ── Model ─────────────────────────────────────────────────────────────────────── ## n= 3000 ## ## node), split, n, deviance, yval ## * denotes terminal node ## ## 1) root 3000 5.672651e+19 66725850 ## 2) budget=15.44456 237 1.528117e+17 17765830 * ## 17) popularity=5.761331 726 1.178595e+18 28701940 ## 34) budget=16.15249 242 4.441208e+17 43919380 * ## 9) popularity=9.734966 507 3.175231e+18 56273980 ## 18) budget=14.04031 35 1.210294e+17 42796710 * ## 19) budget=15.36217 321 2.576473e+18 74464390 ## 38) popularity=19.64394 21 3.602808e+17 166662900 * ## 5) budget=17.19976 593 9.361685e+18 126815400 ## 10) popularity=8.444193 225 1.885623e+18 111828200 * ## 21) budget=17.86726 196 3.325222e+18 161219400 ## 42) popularity=11.60513 70 1.417677e+18 205557600 * ## 11) popularity=19.63372 23 1.474624e+18 359605200 ## 22) runtime=109.5 16 9.882757e+17 299077200 * ## 23) runtime=18.32631 155 1.557371e+19 429978800 ## 6) popularity=18.44536 22 3.814856e+17 206724000 * ## 25) popularity=12.66146 27 8.179336e+17 313197700 ## 50) budget=18.52944 14 5.364675e+17 385998300 * ## 13) budget=18.73897 34 2.072879e+18 437360100 ## 26) runtime=11.34182 17 7.464210e+17 466795200 * ## 27) runtime=132.5 8 7.143147e+17 587149400 * ## 7) popularity=17.26579 54 5.964228e+18 673092200 ## 14) budget  Vorhersage Test-Sample predict(tree_last_fit, new_data = d_test) ## # A tibble: 4,398 × 1 ## .pred ##  ## 1 6074563. ## 2 6074563. ## 3 21093221. ## 4 21093221. ## 5 6074563. ## 6 21093221. ## 7 6074563. ## 8 68256659. ## 9 43919378. ## 10 205557624. ## # … with 4,388 more rows ## # ℹ Use `print(n = ...)` to see more rows RF   Fitten und Tunen Um Rechenzeit zu sparen, kann man das Objekt, wenn einmal berechnet, abspeichern unter result_obj_path auf der Festplatte und beim nächsten Mal importieren, das geht schneller als neu berechnen.\nDas könnte dann z.B. so aussehen:\nif (file.exists(result_obj_path)) { rf_fit % tune_grid( resamples = cv_scheme) toc() } Achtung Ein Ergebnisobjekt von der Festplatte zu laden ist gefährlich. Wenn Sie Ihr Modell verändern, aber vergessen, das Objekt auf der Festplatte zu aktualisieren, werden Ihre Ergebnisse falsch sein (da auf dem veralteten Objekt beruhend), ohne dass Sie durch eine Fehlermeldung von R gewarnt würden!\nSo kann man das Ergebnisobjekt auf die Festplatte schreiben:\n#write_rds(rf_fit, file = \"objects/tmbd_rf_fit1.rds\") Aber wir berechnen lieber neu:\ntic() rf_fit % tune_grid( resamples = cv_scheme, grid = 2) toc() ## 8.623 sec elapsed collect_metrics(rf_fit) ## # A tibble: 4 × 8 ## mtry min_n .metric .estimator mean n std_err .config ##         ## 1 2 11 rmse standard 82295157. 5 5357246. Preprocessor1_… ## 2 2 11 rsq standard 0.640 5 0.0232 Preprocessor1_… ## 3 3 30 rmse standard 82406352. 5 5356881. Preprocessor1_… ## 4 3 30 rsq standard 0.640 5 0.0249 Preprocessor1_… select_best(rf_fit) ## Warning: No value of `metric` was given; metric 'rmse' will be used. ## # A tibble: 1 × 3 ## mtry min_n .config ##    ## 1 2 11 Preprocessor1_Model1  Finalisieren final_wf % finalize_workflow(select_best(rf_fit)) ## Warning: No value of `metric` was given; metric 'rmse' will be used. final_fit  final_preds % predict(new_data = d_test) %% bind_cols(d_test) submission % select(id, revenue = .pred) Abspeichern und einreichen:\nwrite_csv(submission, file = \"submission.csv\")  Kaggle Score Diese Submission erzielte einen Score von 2.7664 (RMSLE).\nsol  Categories:\n ds1 21ss    ",
  "wordCount" : "2602",
  "inLanguage": "en",
  "image":"https://datenwerk.netlify.app/img/cups1.jpg","datePublished": "2022-07-11T00:00:00Z",
  "dateModified": "2022-07-11T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Sebastian Sauer"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://datenwerk.netlify.app/post/tmdb02/tmdb02/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Datenwerk",
    "logo": {
      "@type": "ImageObject",
      "url": "https://datenwerk.netlify.app/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://datenwerk.netlify.app/" accesskey="h" title="Datenwerk (Alt + H)">Datenwerk</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://datenwerk.netlify.app/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="https://datenwerk.netlify.app/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="https://datenwerk.netlify.app/archive/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
            <li>
                <a href="https://datenwerk.netlify.app/about/" title="about">
                    <span>about</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://datenwerk.netlify.app/">Home</a>&nbsp;»&nbsp;<a href="https://datenwerk.netlify.app/post/">Posts</a></div>
    <h1 class="post-title">
      tmdb02
    </h1>
    <div class="post-meta"><span title='2022-07-11 00:00:00 +0000 UTC'>July 11, 2022</span>&nbsp;·&nbsp;13 min&nbsp;·&nbsp;2602 words&nbsp;·&nbsp;Sebastian Sauer

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://datenwerk.netlify.app/img/cups1.jpg" alt="Many aspects, kind of one whole">
        <p>Many aspects, kind of one whole</p>
</figure>
  <div class="post-content">


<!-- ```{r read-supplement} -->
<!-- result_obj_path <- "tmbd_rf_fit1.rds" -->
<!-- #file.exists(here::here("objects", result_obj_path)) -->
<!-- exams::include_supplement(file = result_obj_path, -->
<!--                    recursive = TRUE) -->
<!-- #rf_fit <- readr::read_rds("/Users/sebastiansaueruser/github-repos/rexams-exercises/objects/tmbd_rf_fit1.rds") -->
<!-- ``` -->
<div id="exercise" class="section level1">
<h1>Exercise</h1>
<p>Wir bearbeiten hier die Fallstudie <a href="https://www.kaggle.com/competitions/tmdb-box-office-prediction/overview">TMDB Box Office Prediction -
Can you predict a movie’s worldwide box office revenue?</a>,
ein <a href="https://www.kaggle.com/">Kaggle</a>-Prognosewettbewerb.</p>
<p>Ziel ist es, genaue Vorhersagen zu machen,
in diesem Fall für Filme.</p>
<p>Die Daten können Sie von der Kaggle-Projektseite beziehen oder so:</p>
<pre class="r"><code>d_train_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/train.csv&quot;
d_test_path &lt;- &quot;https://raw.githubusercontent.com/sebastiansauer/Lehre/main/data/tmdb-box-office-prediction/test.csv&quot;</code></pre>
<div id="aufgabe" class="section level5">
<h5>Aufgabe</h5>
<p>Reichen Sie bei Kaggle eine Submission für die Fallstudie ein! Berichten Sie den Kaggle-Score</p>
<p>Hinweise:</p>
<ul>
<li>Sie müssen sich bei Kaggle ein Konto anlegen (kostenlos und anonym möglich); alternativ können Sie sich mit einem Google-Konto anmelden.</li>
<li>Berechnen Sie einen <em>Entscheidungsbaum</em> und einen <em>Random-Forest</em>.</li>
<li>Tunen Sie nach Bedarf; verwenden Sie aber Default-Werte.</li>
<li>Verwenden Sie Tidymodels.</li>
</ul>
<p></br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
</br></p>
</div>
</div>
<div id="solution" class="section level1">
<h1>Solution</h1>
<div id="vorbereitung" class="section level2">
<h2>Vorbereitung</h2>
<pre class="r"><code>library(tidyverse)
library(tidymodels)
library(tictoc)</code></pre>
<pre class="r"><code>d_train &lt;- read_csv(d_train_path)
d_test &lt;- read_csv(d_test_path)

glimpse(d_train)</code></pre>
<pre><code>## Rows: 3,000
## Columns: 23
## $ id                    &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 1…
## $ belongs_to_collection &lt;chr&gt; &quot;[{&#39;id&#39;: 313576, &#39;name&#39;: &#39;Hot Tub Time Machine C…
## $ budget                &lt;dbl&gt; 1.40e+07, 4.00e+07, 3.30e+06, 1.20e+06, 0.00e+00…
## $ genres                &lt;chr&gt; &quot;[{&#39;id&#39;: 35, &#39;name&#39;: &#39;Comedy&#39;}]&quot;, &quot;[{&#39;id&#39;: 35, &#39;…
## $ homepage              &lt;chr&gt; NA, NA, &quot;http://sonyclassics.com/whiplash/&quot;, &quot;ht…
## $ imdb_id               &lt;chr&gt; &quot;tt2637294&quot;, &quot;tt0368933&quot;, &quot;tt2582802&quot;, &quot;tt182148…
## $ original_language     &lt;chr&gt; &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, &quot;hi&quot;, &quot;ko&quot;, &quot;en&quot;, &quot;en&quot;, &quot;en&quot;, …
## $ original_title        &lt;chr&gt; &quot;Hot Tub Time Machine 2&quot;, &quot;The Princess Diaries …
## $ overview              &lt;chr&gt; &quot;When Lou, who has become the \&quot;father of the In…
## $ popularity            &lt;dbl&gt; 6.575393, 8.248895, 64.299990, 3.174936, 1.14807…
## $ poster_path           &lt;chr&gt; &quot;/tQtWuwvMf0hCc2QR2tkolwl7c3c.jpg&quot;, &quot;/w9Z7A0GHEh…
## $ production_companies  &lt;chr&gt; &quot;[{&#39;name&#39;: &#39;Paramount Pictures&#39;, &#39;id&#39;: 4}, {&#39;nam…
## $ production_countries  &lt;chr&gt; &quot;[{&#39;iso_3166_1&#39;: &#39;US&#39;, &#39;name&#39;: &#39;United States of…
## $ release_date          &lt;chr&gt; &quot;2/20/15&quot;, &quot;8/6/04&quot;, &quot;10/10/14&quot;, &quot;3/9/12&quot;, &quot;2/5/…
## $ runtime               &lt;dbl&gt; 93, 113, 105, 122, 118, 83, 92, 84, 100, 91, 119…
## $ spoken_languages      &lt;chr&gt; &quot;[{&#39;iso_639_1&#39;: &#39;en&#39;, &#39;name&#39;: &#39;English&#39;}]&quot;, &quot;[{&#39;…
## $ status                &lt;chr&gt; &quot;Released&quot;, &quot;Released&quot;, &quot;Released&quot;, &quot;Released&quot;, …
## $ tagline               &lt;chr&gt; &quot;The Laws of Space and Time are About to be Viol…
## $ title                 &lt;chr&gt; &quot;Hot Tub Time Machine 2&quot;, &quot;The Princess Diaries …
## $ Keywords              &lt;chr&gt; &quot;[{&#39;id&#39;: 4379, &#39;name&#39;: &#39;time travel&#39;}, {&#39;id&#39;: 96…
## $ cast                  &lt;chr&gt; &quot;[{&#39;cast_id&#39;: 4, &#39;character&#39;: &#39;Lou&#39;, &#39;credit_id&#39;…
## $ crew                  &lt;chr&gt; &quot;[{&#39;credit_id&#39;: &#39;59ac067c92514107af02c8c8&#39;, &#39;dep…
## $ revenue               &lt;dbl&gt; 12314651, 95149435, 13092000, 16000000, 3923970,…</code></pre>
<pre class="r"><code>glimpse(d_test)</code></pre>
<pre><code>## Rows: 4,398
## Columns: 22
## $ id                    &lt;dbl&gt; 3001, 3002, 3003, 3004, 3005, 3006, 3007, 3008, …
## $ belongs_to_collection &lt;chr&gt; &quot;[{&#39;id&#39;: 34055, &#39;name&#39;: &#39;Pokémon Collection&#39;, &#39;p…
## $ budget                &lt;dbl&gt; 0.00e+00, 8.80e+04, 0.00e+00, 6.80e+06, 2.00e+06…
## $ genres                &lt;chr&gt; &quot;[{&#39;id&#39;: 12, &#39;name&#39;: &#39;Adventure&#39;}, {&#39;id&#39;: 16, &#39;n…
## $ homepage              &lt;chr&gt; &quot;http://www.pokemon.com/us/movies/movie-pokemon-…
## $ imdb_id               &lt;chr&gt; &quot;tt1226251&quot;, &quot;tt0051380&quot;, &quot;tt0118556&quot;, &quot;tt125595…
## $ original_language     &lt;chr&gt; &quot;ja&quot;, &quot;en&quot;, &quot;en&quot;, &quot;fr&quot;, &quot;en&quot;, &quot;en&quot;, &quot;de&quot;, &quot;en&quot;, …
## $ original_title        &lt;chr&gt; &quot;ディアルガVSパルキアVSダークライ&quot;, &quot;Attack of t…
## $ overview              &lt;chr&gt; &quot;Ash and friends (this time accompanied by newco…
## $ popularity            &lt;dbl&gt; 3.851534, 3.559789, 8.085194, 8.596012, 3.217680…
## $ poster_path           &lt;chr&gt; &quot;/tnftmLMemPLduW6MRyZE0ZUD19z.jpg&quot;, &quot;/9MgBNBqlH1…
## $ production_companies  &lt;chr&gt; NA, &quot;[{&#39;name&#39;: &#39;Woolner Brothers Pictures Inc.&#39;,…
## $ production_countries  &lt;chr&gt; &quot;[{&#39;iso_3166_1&#39;: &#39;JP&#39;, &#39;name&#39;: &#39;Japan&#39;}, {&#39;iso_3…
## $ release_date          &lt;chr&gt; &quot;7/14/07&quot;, &quot;5/19/58&quot;, &quot;5/23/97&quot;, &quot;9/4/10&quot;, &quot;2/11…
## $ runtime               &lt;dbl&gt; 90, 65, 100, 130, 92, 121, 119, 77, 120, 92, 88,…
## $ spoken_languages      &lt;chr&gt; &quot;[{&#39;iso_639_1&#39;: &#39;en&#39;, &#39;name&#39;: &#39;English&#39;}, {&#39;iso_…
## $ status                &lt;chr&gt; &quot;Released&quot;, &quot;Released&quot;, &quot;Released&quot;, &quot;Released&quot;, …
## $ tagline               &lt;chr&gt; &quot;Somewhere Between Time &amp; Space... A Legend Is B…
## $ title                 &lt;chr&gt; &quot;Pokémon: The Rise of Darkrai&quot;, &quot;Attack of the 5…
## $ Keywords              &lt;chr&gt; &quot;[{&#39;id&#39;: 11451, &#39;name&#39;: &#39;pok√©mon&#39;}, {&#39;id&#39;: 1155…
## $ cast                  &lt;chr&gt; &quot;[{&#39;cast_id&#39;: 3, &#39;character&#39;: &#39;Tonio&#39;, &#39;credit_i…
## $ crew                  &lt;chr&gt; &quot;[{&#39;credit_id&#39;: &#39;52fe44e7c3a368484e03d683&#39;, &#39;dep…</code></pre>
</div>
<div id="rezept" class="section level2">
<h2>Rezept</h2>
<div id="rezept-definieren" class="section level3">
<h3>Rezept definieren</h3>
<pre class="r"><code>rec1 &lt;-
  recipe(revenue ~ ., data = d_train) %&gt;% 
  update_role(all_predictors(), new_role = &quot;id&quot;) %&gt;% 
  update_role(popularity, runtime, revenue, budget) %&gt;% 
  update_role(revenue, new_role = &quot;outcome&quot;) %&gt;% 
  step_mutate(budget = ifelse(budget &lt; 10, 10, budget)) %&gt;% 
  step_log(budget) %&gt;% 
  step_impute_knn(all_predictors())

rec1</code></pre>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##         id         19
##    outcome          1
##  predictor          3
## 
## Operations:
## 
## Variable mutation for ifelse(budget &lt; 10, 10, budget)
## Log transformation on budget
## K-nearest neighbor imputation for all_predictors()</code></pre>
</div>
<div id="check-das-rezept" class="section level3">
<h3>Check das Rezept</h3>
<pre class="r"><code>rec1_prepped &lt;-
  prep(rec1, verbose = TRUE)</code></pre>
<pre><code>## oper 1 step mutate [training] 
## oper 2 step log [training] 
## oper 3 step impute knn [training] 
## The retained training set is ~ 28.71 Mb  in memory.</code></pre>
<pre class="r"><code>rec1_prepped</code></pre>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##         id         19
##    outcome          1
##  predictor          3
## 
## Training data contained 3000 data points and 2793 incomplete rows. 
## 
## Operations:
## 
## Variable mutation for ~ifelse(budget &lt; 10, 10, budget) [trained]
## Log transformation on budget [trained]
## K-nearest neighbor imputation for budget, popularity, runtime [trained]</code></pre>
<pre class="r"><code>d_train_baked &lt;-
  rec1_prepped %&gt;% 
  bake(new_data = NULL) 

head(d_train_baked)</code></pre>
<pre><code>## # A tibble: 6 × 23
##      id belongs_…¹ budget genres homep…² imdb_id origi…³ origi…⁴ overv…⁵ popul…⁶
##   &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;
## 1     1 [{&#39;id&#39;: 3…  16.5  [{&#39;id… &lt;NA&gt;    tt2637… en      Hot Tu… &quot;When …   6.58 
## 2     2 [{&#39;id&#39;: 1…  17.5  [{&#39;id… &lt;NA&gt;    tt0368… en      The Pr… &quot;Mia T…   8.25 
## 3     3 &lt;NA&gt;        15.0  [{&#39;id… http:/… tt2582… en      Whipla… &quot;Under…  64.3  
## 4     4 &lt;NA&gt;        14.0  [{&#39;id… http:/… tt1821… hi      Kahaani &quot;Vidya…   3.17 
## 5     5 &lt;NA&gt;         2.30 [{&#39;id… &lt;NA&gt;    tt1380… ko      마린보… &quot;Marin…   1.15 
## 6     6 &lt;NA&gt;        15.9  [{&#39;id… &lt;NA&gt;    tt0093… en      Pinocc… &quot;Pinoc…   0.743
## # … with 13 more variables: poster_path &lt;fct&gt;, production_companies &lt;fct&gt;,
## #   production_countries &lt;fct&gt;, release_date &lt;fct&gt;, runtime &lt;dbl&gt;,
## #   spoken_languages &lt;fct&gt;, status &lt;fct&gt;, tagline &lt;fct&gt;, title &lt;fct&gt;,
## #   Keywords &lt;fct&gt;, cast &lt;fct&gt;, crew &lt;fct&gt;, revenue &lt;dbl&gt;, and abbreviated
## #   variable names ¹​belongs_to_collection, ²​homepage, ³​original_language,
## #   ⁴​original_title, ⁵​overview, ⁶​popularity
## # ℹ Use `colnames()` to see all variable names</code></pre>
<p>Die AV-Spalte sollte leer sein:</p>
<pre class="r"><code>bake(rec1_prepped, new_data = head(d_test), all_outcomes())</code></pre>
<pre><code>## # A tibble: 6 × 0</code></pre>
<pre class="r"><code>d_train_baked %&gt;% 
  map_df(~ sum(is.na(.)))</code></pre>
<pre><code>## # A tibble: 1 × 23
##      id belongs_…¹ budget genres homep…² imdb_id origi…³ origi…⁴ overv…⁵ popul…⁶
##   &lt;int&gt;      &lt;int&gt;  &lt;int&gt;  &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
## 1     0       2396      0      7    2054       0       0       0       8       0
## # … with 13 more variables: poster_path &lt;int&gt;, production_companies &lt;int&gt;,
## #   production_countries &lt;int&gt;, release_date &lt;int&gt;, runtime &lt;int&gt;,
## #   spoken_languages &lt;int&gt;, status &lt;int&gt;, tagline &lt;int&gt;, title &lt;int&gt;,
## #   Keywords &lt;int&gt;, cast &lt;int&gt;, crew &lt;int&gt;, revenue &lt;int&gt;, and abbreviated
## #   variable names ¹​belongs_to_collection, ²​homepage, ³​original_language,
## #   ⁴​original_title, ⁵​overview, ⁶​popularity
## # ℹ Use `colnames()` to see all variable names</code></pre>
<p>Keine fehlenden Werte mehr <em>in den Prädiktoren</em>.</p>
<p>Nach fehlenden Werten könnte man z.B. auch so suchen:</p>
<pre class="r"><code>datawizard::describe_distribution(d_train_baked)</code></pre>
<pre><code>## Variable   |     Mean |       SD |      IQR |              Range | Skewness | Kurtosis |    n | n_Missing
## ---------------------------------------------------------------------------------------------------------
## id         |  1500.50 |   866.17 |  1500.50 |    [1.00, 3000.00] |     0.00 |    -1.20 | 3000 |         0
## budget     |    12.51 |     6.44 |    14.88 |      [2.30, 19.76] |    -0.87 |    -1.09 | 3000 |         0
## popularity |     8.46 |    12.10 |     6.88 | [1.00e-06, 294.34] |    14.38 |   280.10 | 3000 |         0
## runtime    |   107.85 |    22.08 |    24.00 |     [0.00, 338.00] |     1.02 |     8.20 | 3000 |         0
## revenue    | 6.67e+07 | 1.38e+08 | 6.66e+07 |   [1.00, 1.52e+09] |     4.54 |    27.78 | 3000 |         0</code></pre>
<p>So bekommt man gleich noch ein paar Infos über die Verteilung der Variablen. Praktische Sache.</p>
<p>Das Test-Sample backen wir auch mal:</p>
<pre class="r"><code>d_test_baked &lt;-
  bake(rec1_prepped, new_data = d_test)

d_test_baked %&gt;% 
  head()</code></pre>
<pre><code>## # A tibble: 6 × 22
##      id belongs_…¹ budget genres homep…² imdb_id origi…³ origi…⁴ overv…⁵ popul…⁶
##   &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;
## 1  3001 [{&#39;id&#39;: 3…   2.30 [{&#39;id… &lt;NA&gt;    &lt;NA&gt;    ja      &lt;NA&gt;    &lt;NA&gt;       3.85
## 2  3002 &lt;NA&gt;        11.4  [{&#39;id… &lt;NA&gt;    &lt;NA&gt;    en      &lt;NA&gt;    &lt;NA&gt;       3.56
## 3  3003 &lt;NA&gt;         2.30 [{&#39;id… &lt;NA&gt;    &lt;NA&gt;    en      &lt;NA&gt;    &lt;NA&gt;       8.09
## 4  3004 &lt;NA&gt;        15.7  &lt;NA&gt;   &lt;NA&gt;    &lt;NA&gt;    fr      &lt;NA&gt;    &lt;NA&gt;       8.60
## 5  3005 &lt;NA&gt;        14.5  [{&#39;id… &lt;NA&gt;    &lt;NA&gt;    en      &lt;NA&gt;    &lt;NA&gt;       3.22
## 6  3006 &lt;NA&gt;         2.30 [{&#39;id… &lt;NA&gt;    &lt;NA&gt;    en      &lt;NA&gt;    &lt;NA&gt;       8.68
## # … with 12 more variables: poster_path &lt;fct&gt;, production_companies &lt;fct&gt;,
## #   production_countries &lt;fct&gt;, release_date &lt;fct&gt;, runtime &lt;dbl&gt;,
## #   spoken_languages &lt;fct&gt;, status &lt;fct&gt;, tagline &lt;fct&gt;, title &lt;fct&gt;,
## #   Keywords &lt;fct&gt;, cast &lt;fct&gt;, crew &lt;fct&gt;, and abbreviated variable names
## #   ¹​belongs_to_collection, ²​homepage, ³​original_language, ⁴​original_title,
## #   ⁵​overview, ⁶​popularity
## # ℹ Use `colnames()` to see all variable names</code></pre>
</div>
</div>
<div id="kreuzvalidierung" class="section level2">
<h2>Kreuzvalidierung</h2>
<pre class="r"><code>cv_scheme &lt;- vfold_cv(d_train,
                      v = 5, 
                      repeats = 1)</code></pre>
</div>
<div id="modelle" class="section level2">
<h2>Modelle</h2>
<div id="baum" class="section level3">
<h3>Baum</h3>
<pre class="r"><code>mod_tree &lt;-
  decision_tree(cost_complexity = tune(),
                tree_depth = tune(),
                mode = &quot;regression&quot;)</code></pre>
</div>
<div id="random-forest" class="section level3">
<h3>Random Forest</h3>
<pre class="r"><code>doParallel::registerDoParallel()</code></pre>
<pre class="r"><code>mod_rf &lt;-
  rand_forest(mtry = tune(),
              min_n = tune(),
              trees = 1000,
              mode = &quot;regression&quot;) %&gt;% 
  set_engine(&quot;ranger&quot;, num.threads = 4)</code></pre>
</div>
</div>
<div id="workflows" class="section level2">
<h2>Workflows</h2>
<pre class="r"><code>wf_tree &lt;-
  workflow() %&gt;% 
  add_model(mod_tree) %&gt;% 
  add_recipe(rec1)

wf_rf &lt;-
  workflow() %&gt;% 
  add_model(mod_rf) %&gt;% 
  add_recipe(rec1)</code></pre>
</div>
<div id="fitten-und-tunen" class="section level2">
<h2>Fitten und tunen</h2>
<p>Um Rechenzeit zu sparen,
kann man den Parameter <code>grid</code> bei <code>tune_grid()</code> auf einen kleinen Wert setzen.
Der Default ist 10.
Um gute Vorhersagen zu erzielen,
sollte man den Wert tendenziell noch über 10 erhöhen.</p>
<div id="tree" class="section level3">
<h3>Tree</h3>
<pre class="r"><code>tic()
tree_fit &lt;-
  wf_tree %&gt;% 
  tune_grid(
    resamples = cv_scheme,
    grid = 2
  )
toc()</code></pre>
<pre><code>## 3.374 sec elapsed</code></pre>
<p>Hilfe zu <code>tune_grid()</code> bekommt man <a href="https://www.rdocumentation.org/packages/tune/versions/0.2.0/topics/tune_grid">hier</a>.</p>
<pre class="r"><code>tree_fit</code></pre>
<pre><code>## # Tuning results
## # 5-fold cross-validation 
## # A tibble: 5 × 4
##   splits             id    .metrics         .notes          
##   &lt;list&gt;             &lt;chr&gt; &lt;list&gt;           &lt;list&gt;          
## 1 &lt;split [2400/600]&gt; Fold1 &lt;tibble [4 × 6]&gt; &lt;tibble [0 × 3]&gt;
## 2 &lt;split [2400/600]&gt; Fold2 &lt;tibble [4 × 6]&gt; &lt;tibble [0 × 3]&gt;
## 3 &lt;split [2400/600]&gt; Fold3 &lt;tibble [4 × 6]&gt; &lt;tibble [0 × 3]&gt;
## 4 &lt;split [2400/600]&gt; Fold4 &lt;tibble [4 × 6]&gt; &lt;tibble [0 × 3]&gt;
## 5 &lt;split [2400/600]&gt; Fold5 &lt;tibble [4 × 6]&gt; &lt;tibble [0 × 3]&gt;</code></pre>
<p>Steht was in den <code>.notes</code>?</p>
<pre class="r"><code>tree_fit[[&quot;.notes&quot;]][[2]]</code></pre>
<pre><code>## # A tibble: 0 × 3
## # … with 3 variables: location &lt;chr&gt;, type &lt;chr&gt;, note &lt;chr&gt;
## # ℹ Use `colnames()` to see all variable names</code></pre>
<p>Nein.</p>
<pre class="r"><code>collect_metrics(tree_fit)</code></pre>
<pre><code>## # A tibble: 4 × 8
##   cost_complexity tree_depth .metric .estimator       mean     n std_err .config
##             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;  
## 1   0.00000000100          5 rmse    standard      8.59e+7     5 4.68e+6 Prepro…
## 2   0.00000000100          5 rsq     standard      6.12e-1     5 2.76e-2 Prepro…
## 3   0.00000781             9 rmse    standard      8.76e+7     5 3.86e+6 Prepro…
## 4   0.00000781             9 rsq     standard      5.99e-1     5 2.49e-2 Prepro…</code></pre>
<pre class="r"><code>show_best(tree_fit)</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;rmse&#39; will be used.</code></pre>
<pre><code>## # A tibble: 2 × 8
##   cost_complexity tree_depth .metric .estimator      mean     n  std_err .config
##             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;  
## 1   0.00000000100          5 rmse    standard   85864841.     5 4676421. Prepro…
## 2   0.00000781             9 rmse    standard   87647236.     5 3862933. Prepro…</code></pre>
</div>
</div>
<div id="finalisieren" class="section level2">
<h2>Finalisieren</h2>
<pre class="r"><code>best_tree_wf &lt;-
  wf_tree %&gt;% 
  finalize_workflow(select_best(tree_fit))</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;rmse&#39; will be used.</code></pre>
<pre class="r"><code>best_tree_wf</code></pre>
<pre><code>## ══ Workflow ════════════════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: decision_tree()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 3 Recipe Steps
## 
## • step_mutate()
## • step_log()
## • step_impute_knn()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = 1.00205814434566e-09
##   tree_depth = 5
## 
## Computational engine: rpart</code></pre>
<pre class="r"><code>tree_last_fit &lt;-
  fit(best_tree_wf, data = d_train)

tree_last_fit</code></pre>
<pre><code>## ══ Workflow [trained] ══════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: decision_tree()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 3 Recipe Steps
## 
## • step_mutate()
## • step_log()
## • step_impute_knn()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## n= 3000 
## 
## node), split, n, deviance, yval
##       * denotes terminal node
## 
##  1) root 3000 5.672651e+19   66725850  
##    2) budget&lt; 18.32631 2845 1.958584e+19   46935270  
##      4) budget&lt; 17.19976 2252 5.443953e+18   25901120  
##        8) popularity&lt; 9.734966 1745 1.665118e+18   17076460  
##         16) popularity&lt; 5.761331 1019 3.184962e+17    8793730  
##           32) budget&lt; 15.44456 782 1.408243e+17    6074563 *
##           33) budget&gt;=15.44456 237 1.528117e+17   17765830 *
##         17) popularity&gt;=5.761331 726 1.178595e+18   28701940  
##           34) budget&lt; 16.15249 484 6.504138e+17   21093220 *
##           35) budget&gt;=16.15249 242 4.441208e+17   43919380 *
##        9) popularity&gt;=9.734966 507 3.175231e+18   56273980  
##         18) budget&lt; 15.36217 186 3.092335e+17   24880850  
##           36) popularity&lt; 14.04031 151 1.743659e+17   20728170 *
##           37) popularity&gt;=14.04031 35 1.210294e+17   42796710 *
##         19) budget&gt;=15.36217 321 2.576473e+18   74464390  
##           38) popularity&lt; 19.64394 300 2.025184e+18   68010500 *
##           39) popularity&gt;=19.64394 21 3.602808e+17  166662900 *
##      5) budget&gt;=17.19976 593 9.361685e+18  126815400  
##       10) popularity&lt; 19.63372 570 6.590372e+18  117422100  
##         20) budget&lt; 17.86726 374 2.692151e+18   94469490  
##           40) popularity&lt; 8.444193 149 6.363495e+17   68256660 *
##           41) popularity&gt;=8.444193 225 1.885623e+18  111828200 *
##         21) budget&gt;=17.86726 196 3.325222e+18  161219400  
##           42) popularity&lt; 11.60513 126 1.693483e+18  136587100 *
##           43) popularity&gt;=11.60513 70 1.417677e+18  205557600 *
##       11) popularity&gt;=19.63372 23 1.474624e+18  359605200  
##         22) runtime&gt;=109.5 16 9.882757e+17  299077200 *
##         23) runtime&lt; 109.5 7 2.937458e+17  497955000 *
##    3) budget&gt;=18.32631 155 1.557371e+19  429978800  
##      6) popularity&lt; 17.26579 101 4.711450e+18  299997300  
##       12) budget&lt; 18.73897 67 1.671489e+18  230290900  
##         24) popularity&lt; 12.66146 40 5.426991e+17  174328700  
##           48) budget&lt; 18.44536 18 1.099070e+17  134734600 *
##           49) budget&gt;=18.44536 22 3.814856e+17  206724000 *
##         25) popularity&gt;=12.66146 27 8.179336e+17  313197700  
##           50) budget&lt; 18.52944 13 1.273606e+17  234797100 *
##           51) budget&gt;=18.52944 14 5.364675e+17  385998300 *
##       13) budget&gt;=18.73897 34 2.072879e+18  437360100  
##         26) runtime&lt; 132.5 26 1.123840e+18  391271100  
##           52) popularity&lt; 11.34182 9 9.729505e+16  248614500 *
##           53) popularity&gt;=11.34182 17 7.464210e+17  466795200 *
##         27) runtime&gt;=132.5 8 7.143147e+17  587149400 *
##      7) popularity&gt;=17.26579 54 5.964228e+18  673092200  
##       14) budget&lt; 18.99438 33 2.082469e+18  534404700  
##         28) popularity&lt; 25.35778 19 5.425201e+17  416871200 *
## 
## ...
## and 4 more lines.</code></pre>
</div>
<div id="vorhersage-test-sample" class="section level2">
<h2>Vorhersage Test-Sample</h2>
<pre class="r"><code>predict(tree_last_fit, new_data = d_test)</code></pre>
<pre><code>## # A tibble: 4,398 × 1
##         .pred
##         &lt;dbl&gt;
##  1   6074563.
##  2   6074563.
##  3  21093221.
##  4  21093221.
##  5   6074563.
##  6  21093221.
##  7   6074563.
##  8  68256659.
##  9  43919378.
## 10 205557624.
## # … with 4,388 more rows
## # ℹ Use `print(n = ...)` to see more rows</code></pre>
<div id="rf" class="section level3">
<h3>RF</h3>
</div>
</div>
<div id="fitten-und-tunen-1" class="section level2">
<h2>Fitten und Tunen</h2>
<p>Um Rechenzeit zu sparen,
kann man das Objekt, wenn einmal berechnet,
abspeichern unter <code>result_obj_path</code> auf der Festplatte und beim nächsten Mal importieren,
das geht schneller als neu berechnen.</p>
<p>Das könnte dann z.B. so aussehen:</p>
<pre><code>if (file.exists(result_obj_path)) {
  rf_fit &lt;- read_rds(result_obj_path)
} else {
  tic()
  rf_fit &lt;-
    wf_rf %&gt;% 
    tune_grid(
      resamples = cv_scheme)
  toc()
}</code></pre>
<p><em>Achtung</em> Ein Ergebnisobjekt von der Festplatte zu laden ist <em>gefährlich</em>.
Wenn Sie Ihr Modell verändern, aber vergessen, das Objekt auf der Festplatte zu aktualisieren,
werden Ihre Ergebnisse falsch sein (da auf dem veralteten Objekt beruhend),
ohne dass Sie durch eine Fehlermeldung von R gewarnt würden!</p>
<p>So kann man das Ergebnisobjekt auf die Festplatte schreiben:</p>
<pre class="r"><code>#write_rds(rf_fit, file = &quot;objects/tmbd_rf_fit1.rds&quot;)</code></pre>
<p>Aber wir berechnen lieber neu:</p>
<pre class="r"><code>tic()
rf_fit &lt;-
  wf_rf %&gt;% 
  tune_grid(
    resamples = cv_scheme,
    grid = 2)
toc()</code></pre>
<pre><code>## 8.623 sec elapsed</code></pre>
<pre class="r"><code>collect_metrics(rf_fit)</code></pre>
<pre><code>## # A tibble: 4 × 8
##    mtry min_n .metric .estimator         mean     n      std_err .config        
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt; &lt;chr&gt;          
## 1     2    11 rmse    standard   82295157.        5 5357246.     Preprocessor1_…
## 2     2    11 rsq     standard          0.640     5       0.0232 Preprocessor1_…
## 3     3    30 rmse    standard   82406352.        5 5356881.     Preprocessor1_…
## 4     3    30 rsq     standard          0.640     5       0.0249 Preprocessor1_…</code></pre>
<pre class="r"><code>select_best(rf_fit)</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;rmse&#39; will be used.</code></pre>
<pre><code>## # A tibble: 1 × 3
##    mtry min_n .config             
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;               
## 1     2    11 Preprocessor1_Model1</code></pre>
</div>
<div id="finalisieren-1" class="section level2">
<h2>Finalisieren</h2>
<pre class="r"><code>final_wf &lt;-
  wf_rf %&gt;% 
  finalize_workflow(select_best(rf_fit))</code></pre>
<pre><code>## Warning: No value of `metric` was given; metric &#39;rmse&#39; will be used.</code></pre>
<pre class="r"><code>final_fit &lt;-
  fit(final_wf, data = d_train)</code></pre>
<pre class="r"><code>final_preds &lt;- 
  final_fit %&gt;% 
  predict(new_data = d_test) %&gt;% 
  bind_cols(d_test)</code></pre>
<pre class="r"><code>submission &lt;-
  final_preds %&gt;% 
  select(id, revenue = .pred)</code></pre>
<p>Abspeichern und einreichen:</p>
<pre class="r"><code>write_csv(submission, file = &quot;submission.csv&quot;)</code></pre>
</div>
<div id="kaggle-score" class="section level2">
<h2>Kaggle Score</h2>
<p>Diese Submission erzielte einen Score von <strong>2.7664</strong> (RMSLE).</p>
<pre class="r"><code>sol &lt;- 2.7664</code></pre>
<hr />
<p>Categories:</p>
<ul>
<li>ds1</li>
<li>21ss</li>
</ul>
</div>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://datenwerk.netlify.app/tags/tidymodels/">tidymodels</a></li>
      <li><a href="https://datenwerk.netlify.app/tags/prediction/">prediction</a></li>
      <li><a href="https://datenwerk.netlify.app/tags/tmdb/">tmdb</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://datenwerk.netlify.app/post/tmdb01/tmdb01/">
    <span class="title">« Prev</span>
    <br>
    <span>tmdb01</span>
  </a>
  <a class="next" href="https://datenwerk.netlify.app/post/tmdb03/tmdb03/">
    <span class="title">Next »</span>
    <br>
    <span>tmdb03</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share tmdb02 on twitter"
        href="https://twitter.com/intent/tweet/?text=tmdb02&amp;url=https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f&amp;hashtags=tidymodels%2cprediction%2ctmdb">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share tmdb02 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f&amp;title=tmdb02&amp;summary=tmdb02&amp;source=https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share tmdb02 on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f&title=tmdb02">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share tmdb02 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share tmdb02 on whatsapp"
        href="https://api.whatsapp.com/send?text=tmdb02%20-%20https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share tmdb02 on telegram"
        href="https://telegram.me/share/url?text=tmdb02&amp;url=https%3a%2f%2fdatenwerk.netlify.app%2fpost%2ftmdb02%2ftmdb02%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://datenwerk.netlify.app/">Datenwerk</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
